/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var strawberry_fields_high_conf = ee.FeatureCollection("users/kevinlc3/strawberry_fields_geometry_highconf");
/***** End of imports. If edited, may not auto-convert in the playground. *****/
//https://google-earth-engine.com/Advanced-Topics/Scaling-up-in-Earth-Engine/

//init globals

var startDate = '2016-01-1';
var endDate = '2016-12-30';
var nirv_collection = ee.ImageCollection('NASA/HLS/HLSL30/v002')
  .filterDate(startDate, endDate)

function batch_process_feature(crop_field) {
  // Filter NIRV data for the specific field
  var nirv_field = nirv_collection.filterBounds(crop_field.geometry())
                                  .map(maskClouds)
                                  .map(dataset_ndvi)
                                  .map(dataset_nirv)
                                  .select(['NIRV']);
  
  // Filter PAR data for the specific field (if needed)
  var par_field = par_collection.filterBounds(crop_field.geometry());
  // ... apply any necessary processing to par_field ...

  // Combine NIRV and PAR data (if necessary)
  // ... code to combine NIRV and PAR data ...

  // Apply any models or additional processing
  // For example, applying hyperbola model
  var processedImage = nirv_field.map(applyHyperbola);

  // Export or store results
  // Placeholder for exporting or storing the processed image
  // Export.image.toAsset({...});
}

// Apply batch processing to each feature
strawberry_fields_california_highconf.map(batch_process_feature);